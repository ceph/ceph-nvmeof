FROM fedora:33 AS base

# Generic args
ARG spdk_version
ARG PROXY
ARG NO_PROXY

ENV http_proxy=$PROXY
ENV https_proxy=$PROXY
ENV no_proxy=$NO_PROXY

RUN dnf install -y rpm-build librbd-devel git

COPY ./spdk /tmp/spdk

COPY ./docker/pre-install /install
COPY ./docker/post-install /post-install

RUN /install $spdk_version
RUN /post-install

CMD ["/bin/bash"]
